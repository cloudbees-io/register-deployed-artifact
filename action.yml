apiVersion: automation.cloudbees.io/v1alpha1
kind: action
name: 'Register deployed artifact'
description: 'Creates an artifact version association with the environment.'

inputs:
  name:
    description: 'The name of the artifact.'
    required: true
  version:
    description: 'The version of the artifact.'
    required: true
  url:
    description: 'The url where the artifact version is located e.g. docker.io/myapp/myimg:1.0.0.'
    required: true
  digest:
    description: 'The artifact digest that uniquely and immutably identifies the artifact.'
  target-environment:
    description: 'The environment where the deployment occurred.'
  labels:
    description: 'List of comma-separated labels.'

runs:
  using: composite
  steps:
    - id: registerDeployedArtifact
      name: Register Deployed Artifact
      uses: docker://esolang/jq:latest
      run: |
        echo "❌️ ERROR: This action version (v1) is deprecated and is no longer supported." 
        echo "❌️ ERROR: Please update your workflows to use 'cloudbees-io/register-deployed-artifact@v2'."
        exit 1
      env:
        JWT: ${{ cloudbees.api.token }}
        URL: ${{ cloudbees.api.url }}
        INPUT_NAME: ${{ inputs.name }}
        INPUT_VERSION: ${{ inputs.version }}
        INPUT_URL: ${{ inputs.url }}
        INPUT_DIGEST: ${{ inputs.digest }}
        INPUT_TARGET_ENV: ${{ inputs.target-environment }}
        INPUT_LABELS: ${{ inputs.labels }}
        CLOUDBEES_RUN_ID: ${{ cloudbees.run_id }}
        CLOUDBEES_RUN_ATTEMPT: ${{ cloudbees.run_attempt }}

